(()=>{"use strict";var e;!function(e){e.QUEUE_STATUS="QUEUE_STATUS",e.SEND_MESSAGE="SEND_MESSAGE",e.PAUSE_QUEUE="PAUSE_QUEUE",e.RESUME_QUEUE="RESUME_QUEUE",e.STOP_QUEUE="STOP_QUEUE",e.ADD_LOG="ADD_LOG"}(e||(e={}));var n=function(e,n,o,t){return new(o||(o=Promise))((function(s,a){function r(e){try{d(t.next(e))}catch(e){a(e)}}function i(e){try{d(t.throw(e))}catch(e){a(e)}}function d(e){var n;e.done?s(e.value):(n=e.value,n instanceof o?n:new o((function(e){e(n)}))).then(r,i)}d((t=t.apply(e,n||[])).next())}))};function o(e){return new Promise((n=>{var o=document.createElement("script");o.src=chrome.runtime.getURL(e),o.onload=function(){this instanceof HTMLElement&&null!==this.parentNode&&this.parentNode.removeChild(this),n(!0)},(document.head||document.documentElement).appendChild(o)}))}new class{constructor(e){this.source=e,"contentScript"===this.source&&(this.forwardMessagesFromWebpageToPopup(),this.forwardResponsesFromPopupToWebpage())}forwardMessagesFromWebpageToPopup(){window.addEventListener("message",(e=>{e.source===window&&e.origin===window.location.origin&&chrome.runtime.sendMessage(e.data)}))}forwardResponsesFromPopupToWebpage(){chrome.runtime.onMessage.addListener((e=>{window.postMessage(e,window.location.origin)}))}addHandler(e,n){try{"webpage"!==this.source&&this.addExtensionMessageHandler(e,n),"popup"!==this.source&&this.addWebpageMessageHandler(e,n)}catch(e){console.error("WTF.AsyncChromeMessageManager.addHandler",e)}}addWebpageMessageHandler(e,n){window.addEventListener("message",(o=>{o.source===window&&o.origin===window.location.origin&&o.data.type===e&&n(o.data.payload).then((n=>{window.postMessage({type:`${e}_RESPONSE`,payload:n},window.location.origin)})).catch((n=>{console.error(`WTF.AsyncChromeMessageManager.addWebpageMessageHandler ${e}_RESPONSE`,n)}))}))}addExtensionMessageHandler(e,n){chrome.runtime.onMessage.addListener((o=>{o.type===e&&n(o.payload).then((n=>{chrome.runtime.sendMessage({type:`${e}_RESPONSE`,payload:n})})).catch((n=>{console.error(`WTF.AsyncChromeMessageManager.addExtensionMessageHandler ${e}_RESPONSE`,n)}))}))}sendMessage(e,n){return o=this,t=void 0,a=function*(){const o={type:e,payload:n};return new Promise(((n,t)=>{try{const t=o=>{o.type===`${e}_RESPONSE`&&(chrome.runtime.onMessage.removeListener(t),n(o.payload))};"popup"!==this.source&&this.sendWebpageMessage(o,t),"webpage"!==this.source&&this.sendExtensionMessage(o,t)}catch(e){console.error("WTF.AsyncChromeMessageManager.sendMessage",e),t(e)}}))},new((s=void 0)||(s=Promise))((function(e,n){function r(e){try{d(a.next(e))}catch(e){n(e)}}function i(e){try{d(a.throw(e))}catch(e){n(e)}}function d(n){var o;n.done?e(n.value):(o=n.value,o instanceof s?o:new s((function(e){e(o)}))).then(r,i)}d((a=a.apply(o,t||[])).next())}));var o,t,s,a}sendWebpageMessage(e,n){window.postMessage(e,window.location.origin);const o=e=>{e.source===window&&e.origin===window.location.origin&&(n(e.data),window.removeEventListener("message",o))};window.addEventListener("message",o)}sendExtensionMessage(e,n){chrome.runtime.onMessage.addListener(n),"popup"===this.source?chrome.tabs.query({active:!0,currentWindow:!0},(n=>{n[0].id&&chrome.tabs.sendMessage(n[0].id,e)})):"contentScript"===this.source&&chrome.runtime.sendMessage(e)}}("contentScript").addHandler(e.ADD_LOG,(e=>n(void 0,void 0,void 0,(function*(){try{return yield function({level:e,message:o,attachment:t=!1,contact:s}){return n(this,void 0,void 0,(function*(){return chrome.storage.local.get({logs:[]},(a=>n(this,void 0,void 0,(function*(){const n=a.logs;return n.push({level:e,message:o,attachment:t,contact:s,date:(new Date).toLocaleString()}),chrome.storage.local.set({logs:n})}))))}))}(e),!0}catch(e){return!1}})))),"complete"===document.readyState?o("js/wa-js.js"):document.addEventListener("DOMContentLoaded",(()=>{o("js/wa-js.js")}))})();